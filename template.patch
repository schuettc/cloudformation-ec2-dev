26,27c26,27
<   VPCId:
<     Description: 'VPC to use or create new'
---
>   VPCId:
>     Description: 'VPC to use or create new (leave blank to create new)'
33,34c33,34
<   SubnetId:
<     Description: 'Subnet to use or create new'
---
>   SubnetId:
>     Description: 'Subnet to use or create new (leave blank to create new)'
66,67c66,67
<   CreateNewVPC: !Equals [!Ref VPCId, '']
<   CreateNewSubnet: !And
---
>   CreateNewVPC: !Equals [!Ref VPCId, ''] && !Equals [!Ref SubnetId, '']
>   CreateNewSubnet: !And
99,100c99,100
<   DevVPC:
<     Type: AWS::EC2::VPC
---
>   DevVPC:
>     Type: AWS::EC2::VPC
104,111c104,111
<     Condition: CreateNewVPC
<     Properties:
<       CidrBlock: 10.0.0.0/16
<       EnableDnsHostnames: true
<       EnableDnsSupport: true
<       InstanceTenancy: default
<       Tags:
<         - Key: Name
---
>     Condition: CreateNewVPC
>     Properties:
>       CidrBlock: 10.0.0.0/16
>       EnableDnsHostnames: true
>       EnableDnsSupport: true
>       InstanceTenancy: default
>       Tags:
>         - Key: Name
126,133c126,133
<       Condition: CreateNewSubnet
<       Properties:
<         CidrBlock: 10.0.0.0/24
<         VpcId:
<           Ref: DevVPC
<         AvailabilityZone:
<           Fn::Select:
---
>     Condition: CreateNewSubnet
>     Properties:
>       CidrBlock: 10.0.0.0/24
>       VpcId:
>         Ref: DevVPC
>       AvailabilityZone:
>         Fn::Select:
138,145c138,145
<   DevSubnet1RouteTable:
<     Type: AWS::EC2::RouteTable
---
>     Type: AWS::EC2::RouteTable
149,156c149,156
<       Condition: CreateNewVPC
<       Properties:
<         VpcId:
<           Ref: DevVPC
<         Tags:
<           - Key: Name
---
>     Condition: CreateNewVPC
>     Properties:
>       VpcId:
>         Ref: DevVPC
>       Tags:
>         - Key: Name
160,167c160,167
<   DevSubnet1RouteTableAssociation:
<     Type: AWS::EC2::SubnetRouteTableAssociation
---
>     Type: AWS::EC2::SubnetRouteTableAssociation
171,178c171,178
<       Condition: CreateNewVPC
<       Properties:
<         RouteTableId:
<           Ref: DevSubnet1RouteTable
<         SubnetId:
<           Ref: DevSubnet1
---
>     Condition: CreateNewVPC
>     Properties:
>       RouteTableId:
>         Ref: DevSubnet1RouteTable
>       SubnetId:
>         Ref: DevSubnet1
182,189c182,189
<   DevSubnet1DefaultRoute:
<     Type: AWS::EC2::Route
---
>     Type: AWS::EC2::Route
193,200c193,200
<       Condition: CreateNewVPC
<       Properties:
<         RouteTableId:
<           Ref: DevSubnet1RouteTable
<         DestinationCidrBlock: 0.0.0.0/0
<         GatewayId:
<           Ref: VPCInternetGateway
---
>     Condition: CreateNewVPC
>     Properties:
>       RouteTableId:
>         Ref: DevSubnet1RouteTable
>       DestinationCidrBlock: 0.0.0.0/0
>       GatewayId:
>         Ref: VPCInternetGateway
204,211c204,211
<   DevSubnet2:
<     Type: AWS::EC2::Subnet
---
>     Type: AWS::EC2::Subnet
215,222c215,222
<       Condition: CreateNewSubnet
<       Properties:
<         CidrBlock: 10.0.1.0/24
<         VpcId:
<           Ref: DevVPC
<         AvailabilityZone:
<           Fn::Select:
---
>     Condition: CreateNewSubnet
>     Properties:
>       CidrBlock: 10.0.1.0/24
>       VpcId:
>         Ref: DevVPC
>       AvailabilityZone:
>         Fn::Select:
226,233c226,233
<   DevSubnet2RouteTable:
<     Type: AWS::EC2::RouteTable
---
>     Type: AWS::EC2::RouteTable
237,244c237,244
<       Condition: CreateNewVPC
<       Properties:
<         VpcId:
<           Ref: DevVPC
<         Tags:
<           - Key: Name
---
>     Condition: CreateNewVPC
>     Properties:
>       VpcId:
>         Ref: DevVPC
>       Tags:
>         - Key: Name
248,255c248,255
<   DevSubnet2RouteTableAssociation:
<     Type: AWS::EC2::SubnetRouteTableAssociation
---
>     Type: AWS::EC2::SubnetRouteTableAssociation
259,266c259,266
<       Condition: CreateNewVPC
<       Properties:
<         RouteTableId:
<           Ref: DevSubnet2RouteTable
<         SubnetId:
<           Ref: DevSubnet2
---
>     Condition: CreateNewVPC
>     Properties:
>       RouteTableId:
>         Ref: DevSubnet2RouteTable
>       SubnetId:
>         Ref: DevSubnet2
270,277c270,277
<   DevSubnet2DefaultRoute:
<     Type: AWS::EC2::Route
---
>     Type: AWS::EC2::Route
281,288c281,288
<       Condition: CreateNewVPC
<       Properties:
<         RouteTableId:
<           Ref: DevSubnet2RouteTable
<         DestinationCidrBlock: 0.0.0.0/0
<         GatewayId:
<           Ref: VPCInternetGateway
---
>     Condition: CreateNewVPC
>     Properties:
>       RouteTableId:
>         Ref: DevSubnet2RouteTable
>       DestinationCidrBlock: 0.0.0.0/0
>       GatewayId:
>         Ref: VPCInternetGateway
292,298c292,298
<   VPCInternetGateway:
<     Type: AWS::EC2::InternetGateway
---
>     Type: AWS::EC2::InternetGateway
302,310c302,310
<       Condition: CreateNewVPC
<       Properties:
<         Tags:
<           - Key: Name
<             Value: Dev/VPC
---
>     Condition: CreateNewVPC
>     Properties:
>       Tags:
>         - Key: Name
>           Value: Dev/VPC
314,322c314,322
<   VPCGatewayAttachment:
<     Type: AWS::EC2::VPCGatewayAttachment
---
>     Type: AWS::EC2::VPCGatewayAttachment
326,334c326,334
<       Condition: CreateNewVPC
<       Properties:
<         VpcId:
<           Ref: DevVPC
<         InternetGatewayId:
<           Ref: VPCInternetGateway
---
>     Condition: CreateNewVPC
>     Properties:
>       VpcId:
>         Ref: DevVPC
>       InternetGatewayId:
>         Ref: VPCInternetGateway
338,347c338,347
<   DevSecurityGroup:
<     Type: AWS::EC2::SecurityGroup
---
>     Type: AWS::EC2::SecurityGroup
351,359c351,359
<       VpcId: !If
<         - CreateNewVPC
<         - !Ref DevVPC
<         - !Ref VPCId
---
>       VpcId: !If
>         - CreateNewVPC
>         - !Ref DevVPC
>         - !Ref VPCId
401,408c401,408
<       SubnetId: !If
<         - CreateNewSubnet
<         - !Ref DevSubnet1
<         - !Ref SubnetId
---
>       SubnetId: !If
>         - CreateNewSubnet
>         - !Ref DevSubnet1
>         - !Ref SubnetId
